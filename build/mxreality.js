var VR=function(e,t,i,r,o){this.scene=e,this.renderer=t,this.container=i,AVR.initDomStyle(i),AVR.setCameraPara(this,r,o),this.vrbox={radius:2,widthSegments:180,heightSegments:180,width:2,height:2,depth:2},this.video=null,this.audio=null,this.toolBar=null,this.clock=new THREE.Clock,this.VRObject=new THREE.Object3D,this.defaultAutoHideLeftTime=3,this.defaultVoiceHideLeftTime=2,this.defaultVolume=.3,this.sliceSegment=0,this._controlTarget=new THREE.Vector3(0,0,1e-4),this._cubeCameraTimes=.96,this.resType={video:"video",box:"box",slice:"slice",sliceVideo:"sliceVideo"},this.asteroidConfig={enable:!1,asteroidFPS:10,asteroidFov:135,asteroidForwardTime:2600,asteroidWaitTime:2e3,asteroidDepressionRate:.5,asteroidTop:1,cubeResolution:2048,rotationAngleOfZ:0},this.VRhint="请取消屏幕翻转锁定后装入VR盒子中",this.camera=new THREE.PerspectiveCamera(this.cameraPara.fov,this.cameraPara.aspect,this.cameraPara.near,this.cameraPara.far),this.camera.lookAt(this._controlTarget),this.cameraEvt={controlGroup:function(){},updatePosition:function(){},hover:function(){},leave:function(){}},this._takeScreenShot=!1,this.camera.position.set(this.cameraPosition.x,this.cameraPosition.y,this.cameraPosition.z),this.loadProgressManager=new THREE.LoadingManager(function(e){console.log("loaded")},function(e,t,i){console.log("item=",e,"loaded",t,"total=",i)},function(e,t){console.log(e,t)}),this.scene.add(this.camera),this.scene.add(this.VRObject),this.effect=AVR.stereoEffect(this.renderer),AVR.bindOrientationEnevt(this,this._controlTarget)};VR.prototype.init=function(r){var u=this,o=new THREE.Vector2,n=new THREE.Vector2;u.toolBar=AVR.toolBar(u.container);var t,i,m=u.toolBar,c={},l=0;function e(e){m.isMouseDown=!0;var t=e.clientX||e.changedTouches[0].clientX,i=e.clientY||e.changedTouches[0].clientY;o.set(t,i),n.set(t,i),u.autoHideLeftTime=u.defaultAutoHideLeftTime,m.isActive=!0}function a(e){m.isMouseDown=!1}function s(e){if(e.preventDefault(),u.autoHideLeftTime=u.defaultAutoHideLeftTime,u.toolBar.isActive=!0,m.isMouseDown){var t=e.clientX||e.changedTouches[0].clientX,i=e.clientY||e.changedTouches[0].clientY,r=n.y-i;5<=r&&d(6),r<=-5&&d(-10),n.set(t,i)}}function d(t){var i=setInterval(function(){var e=m.toolbar.clientHeight+t;e>=m.defaultHeight&&e<=m.defaultMaxHeight?(m.toolbar.style.height=e+"px",m.isActive=!0):(clearInterval(i),0<t?(m.isActive=!0,m.moreBtn.style.transform="rotate(-180deg)",m.moreBtn.style.webkitTransform="rotate(-180deg)",m.toolbar.style.height=m.defaultMaxHeight+"px",m.about.style.display="block"):(m.isActive=!1,m.moreBtn.style.transform="rotate(0deg)",m.moreBtn.style.webkitTransform="rotate(0deg)",m.toolbar.style.height=m.defaultHeight+"px",m.about.style.display="none")),u.autoHideLeftTime=u.defaultAutoHideLeftTime},1)}function h(e){u.autoHideLeftTime=u.defaultAutoHideLeftTime,m.isActive=!0;var t=e.clientX||e.changedTouches[0].clientX,i=e.clientY||e.changedTouches[0].clientY;m.isMouseDown&&(m.moreList.scrollLeft+=2.5*(n.x-t)),n.set(t,i)}function v(e){(e.style.borderColor="green",e.style.color="green",u.cameraEvt.controlGroup.length)&&(u.cameraEvt.controlGroup.getObjectByName("__focus").visible=!0)}function f(e){(e.style.borderColor="white",e.style.color="white",u.cameraEvt.controlGroup.length)&&(u.cameraEvt.controlGroup.getObjectByName("__focus").visible=!1)}function p(){var r=u.video||u.audio;if(r){m.voice_bar.style.display="block";var i,t=m.voice_bar,e=t.firstChild,o=e.firstChild,n=(o.firstChild,!1),a=0,s=0;r.volume=u.defaultVolume;var c=m.voice_bar.clientHeight,l=(u.container.clientHeight-c)/2,d=c+l;o.style.height=r.volume*c+"px",t.addEventListener("mousedown",function(e){t.style.opacity=1},!1),e.addEventListener("click",function(e){var t=(e.clientY||e.changedTouches[0].clientY)-u.container.offsetTop;u.voiceHideLeftTime=u.defaultVoiceHideLeftTime;var i=d-t;i/c<=1&&(o.style.height=i+"px",r.volume=i/c)},!1),t.addEventListener("mouseout",function(e){n=!1},!1),t.addEventListener("mousedown",function(e){n=!0},!1),t.addEventListener("mouseup",function(e){n=!1},!1),t.addEventListener("mousemove",function(e){var t=(e.clientY||e.changedTouches[0].clientY)-u.container.offsetTop;if(u.voiceHideLeftTime=u.defaultVoiceHideLeftTime,n){var i=d-t;o.style.height=i+"px",i/c<=1&&(r.volume=i/c)}},!1),t.addEventListener("touchstart",function(e){e.preventDefault(),u.voiceHideLeftTime=u.defaultVoiceHideLeftTime,i=o.clientHeight,a=e.touches[0].pageY,t.style.opacity=1},!1),t.addEventListener("touchmove",function(e){e.preventDefault(),u.voiceHideLeftTime=u.defaultVoiceHideLeftTime,s=e.touches[0].pageY;var t=i+(a-s);t/c<=1&&(o.style.height=t+"px",r.volume=t/c)},!1),t.addEventListener("touchend",function(e){i=0},!1),setInterval(function(){u.voiceHideLeftTime<=0?t.style.opacity=0:!u.toolBar.isActive&&u.voiceHideLeftTime--},1e3)}}m.defaultHeight=m.toolbar.clientHeight,m.defaultMaxHeight=5*m.defaultHeight,m.isMouseDown=!1,u.container.addEventListener("click",function(){u.autoHideLeftTime=u.defaultAutoHideLeftTime,m.toolbar.style.display="block"}),m.gyroBtn.addEventListener("click",function(){u.gyroBtnClick()},!1),m.vrBtn.addEventListener("click",function(){u.vrBtnClick()},!1),m.moreBtn.addEventListener("click",function(){u.moreBtnClick()},!1),u.container.addEventListener("touchstart",function(e){u.touchStart(e)},!1),u.container.addEventListener("touchmove",function(e){u.touchMove(e)},!1),u.container.addEventListener("touchend",function(e){u.touchEnd(e)},!1),m.gyroResetBtn.addEventListener("click",function(){u.controls&&u.controls.reset()},!1),m.toolbar.addEventListener("mousedown",e,!1),m.toolbar.addEventListener("touchstart",e,!1),m.toolbar.addEventListener("mousemove",s,!1),m.toolbar.addEventListener("touchmove",s,!1),m.toolbar.addEventListener("mouseup",a,!1),m.toolbar.addEventListener("touchend",a,!1),m.toolbar.addEventListener("mouseout",function(e){u.autoHideLeftTime=u.defaultAutoHideLeftTime,m.isActive=!1},!1),u.renderer.domElement.addEventListener("wheel",function(e){var t,i=0<e.deltaY?15:-15;10<=u.camera.fov+.05*i&&u.camera.fov+.05*i<=120&&(t=i,u.camera.fov+=.05*t,u.camera.updateProjectionMatrix())},!1),m.moreList.addEventListener("mousemove",h,!1),m.moreList.addEventListener("touchmove",h,!1),u.moreBtnClick=function(e){m.toolbar.clientHeight>m.defaultHeight?d(-10):d(6)},u.vrBtnClick=function(e){var t=u.toolBar.vrBtn;AVR.isMobileDevice()?AVR.OS.isWeixin()&&!AVR.OS.isiOS()?"landscape"==u.video.getAttribute("x5-video-orientation")?(u.video.setAttribute("x5-video-orientation","portraint"),f(t)):(u.video.setAttribute("x5-video-orientation","landscape"),v(t)):AVR.isCrossScreen()?(v(t),AVR.fullscreen(u.container)):(f(t),AVR.msgBox(u.VRhint,5,u.container)):(t.getAttribute("fullscreen")?(f(t),t.removeAttribute("fullscreen")):(v(t),t.setAttribute("fullscreen","true")),AVR.fullscreen(u.container))},u.gyroBtnClick=function(e){var t=u.toolBar.gyroBtn;t.getAttribute("active")?(u.controls.gyroUnfreeze(),t.removeAttribute("active"),f(t),f(m.circle1),f(m.circle2)):(u.controls.gyroFreeze(),v(t),v(m.circle1),v(m.circle2),t.setAttribute("active","active"))},u.touchStart=function(e){e.targetTouches&&([].forEach.call(e.targetTouches,function(e){c[e.identifier]||(c[e.identifier]=new THREE.Vector2(0,0))}),i=setInterval(function(){!function(e){if(void 0===u.controls.defaultDampingFactor&&(u.controls.defaultDampingFactor=u.controls.dampingFactor),void 0===u.controls.object.defaultFov&&(u.controls.object.defaultFov=u.controls.object.fov),!e)return;var a=0,s=[];[].forEach.call(e,function(e){var t=c[e.identifier];if(t&&(t.y=e.pageY,t.x=e.pageX,s.push(e.identifier)),2<=++a){var i=c[s[0]],r=c[s[1]],o=Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)),n=(o-l)/4;return u.controls.object.fov-n<140&&10<u.controls.object.fov-n&&l&&(u.controls.enable=!1,u.controls.object.fov-=n,u.controls.dampingFactor=u.controls.defaultDampingFactor*u.controls.object.defaultFov/u.controls.object.fov),l=o,void(a=0)}})}(t)},1))},u.touchEnd=function(e){e.targetTouches&&([].forEach.call(e.changedTouches,function(e){c[e.identifier]&&delete c[e.identifier]}),0===e.targetTouches.length&&(l=0,u.controls.enable=!0,clearInterval(i)))},u.touchMove=function(e){t=e.touches},u.windowResize=function(){AVR.isFullscreen()?AVR.isMobileDevice()?AVR.isCrossScreen()?v(u.toolBar.vrBtn):f(u.toolBar.vrBtn):v(u.toolBar.vrBtn):AVR.OS.isWeixin()&&!AVR.OS.isiOS()?("landscape"==u.video.getAttribute("x5-video-orientation")?v(u.toolBar.vrBtn):f(u.toolBar.vrBtn),AVR.isCrossScreen()?v(u.toolBar.vrBtn):f(u.toolBar.vrBtn)):(AVR.isCrossScreen()?v(u.toolBar.vrBtn):f(u.toolBar.vrBtn),f(u.toolBar.vrBtn))},window.addEventListener("resize",function(){p()},!1),u._play=function(){m.btn.style.border="none",m.btn.style.fontWeight=800,m.btn.innerHTML="<b>||</b>"},u._pause=function(){m.btn.innerText="",m.btn.style.borderTop="0.6rem solid transparent",m.btn.style.borderLeft="1rem solid white",m.btn.style.borderBottom="0.6rem solid transparent"},u.bindVolumeBar=p,function e(){!function(){var e=u.container.offsetWidth,t=u.container.offsetHeight;if(u.camera.aspect=e/t,AVR.isMobileDevice()&&AVR.isCrossScreen()?(u.cameraEvt.updatePosition(),u.effect.setSize(e,t),u.effect.render(u.scene,u.camera)):(u.renderer.setSize(e,t),u.renderer.setClearColor(new THREE.Color(16777215)),u.renderer.render(u.scene,u.camera)),u._takeScreenShot){u._takeScreenShot=!1;var i=u.renderer.domElement.toDataURL("image/jpeg");u._takeScreenShotCallback(i)}u.camera.updateProjectionMatrix(),u.controls&&u.controls.update(),r()}(),requestAnimationFrame(e)}(),setInterval(function(){m.isActive||(u.autoHideLeftTime<0?(m.toolbar.style.display="none",u.autoHideLeftTime=u.defaultAutoHideLeftTime,m.isActive=!1):u.autoHideLeftTime--),u.windowResize()},1e3)},VR.prototype.takeScreenShot=function(e){this._takeScreenShot=!0,this._takeScreenShotCallback=e},VR.prototype.playPanorama=function(e,t){var i=["__mxrealitySkybox","__mxrealitySlice","__mxrealityDefault"];for(var r in i){(o=this.VRObject.getObjectByName(i[r]))&&(o.visible=!1),this.cubeCameraSphere&&(this.cubeCameraSphere.visible=!1)}var d=this,n=d.toolBar;if(d._containerRadius=d.resType.box==t||d.resType.slice==t?d.vrbox.width/2:d.vrbox.radius,d.autoHideLeftTime=d.defaultAutoHideLeftTime,d.voiceHideLeftTime=d.defaultVoiceHideLeftTime,d.resType.box==t){d.toolBar.timeInfo.style.display="none";var a=[],s=[],c=new Image;c.crossOrigin="Anonymous",c.src=e,c.onload=function(){for(var e,t,i=c.height,r=0;r<6;r++)a[r]=new THREE.Texture,t=(e=document.createElement("canvas")).getContext("2d"),e.height=i,e.width=i,t.drawImage(c,i*r,0,i,i,0,0,i,i),a[r].image=e,a[r].needsUpdate=!0,s.push(new THREE.MeshBasicMaterial({map:a[r]}));var o;(o=d.VRObject.getObjectByName("__mxrealitySkybox"))?o.material=s:((o=new THREE.Mesh(new THREE.CubeGeometry(d.vrbox.width,d.vrbox.height,d.vrbox.depth),new THREE.MultiMaterial(s))).applyMatrix((new THREE.Matrix4).makeScale(1,1,-1)),o.visible=!1,o.name="__mxrealitySkybox",o.matrixAutoUpdate=!1,o.updateMatrix(),d.VRObject.add(o),n.btn.addEventListener("click",function(e){d.controls.autoRotate?d._pause():d._play(),d.controls.autoRotate=!d.controls.autoRotate}));d.loadProgressManager.onLoad()}}else if(d.resType.slice==t){d.toolBar.timeInfo.style.display="none";var o,l=new THREE.TextureLoader(d.loadProgressManager);l.mapping=THREE.UVMapping;for(s=[],r=0;r<e.length;r++){var u=l.load(e[r]);s.push(new THREE.MeshBasicMaterial({map:u}))}for(var m=new THREE.CubeGeometry(d.vrbox.width,d.vrbox.height,d.vrbox.depth,d.sliceSegment,d.sliceSegment,d.sliceSegment),h=0,v=[new THREE.Vector2(0,0),new THREE.Vector2(1,0),new THREE.Vector2(1,1),new THREE.Vector2(0,1)],f=(r=0,m.faces.length);r<f;r+=2)m.faces[r].materialIndex=h,m.faces[r+1].materialIndex=h,m.faceVertexUvs[0][r]=[v[3],v[0],v[2]],m.faceVertexUvs[0][r+1]=[v[0],v[1],v[2]],h++;if(o=d.VRObject.getObjectByName("__mxrealitySlice"))o.material=s,o.geometry=m,o.updateMatrix();else{var p=new THREE.Mesh(m,s);p.applyMatrix((new THREE.Matrix4).makeScale(1,1,-1)),p.name="__mxrealitySlice",p.visible=!1,p.matrixAutoUpdate=!1,p.updateMatrix(),d.VRObject.add(p),d.cubeCamera=new THREE.CubeCamera(d._containerRadius,d.cameraPara.far,d.asteroidConfig.cubeResolution),d.cubeCamera.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,d.VRObject.add(d.cubeCamera),material=new THREE.MeshBasicMaterial({envMap:d.cubeCamera.renderTarget.texture,side:THREE.BackSide}),d.cubeCameraSphere=new THREE.Mesh(new THREE.SphereGeometry(d._containerRadius*d._cubeCameraTimes,180,180),material),d.cubeCameraSphere.position.set(0,0,0),d.cubeCameraSphere.name="__mxrealitySlice",d.cubeCameraSphere.visible=!1,d.cubeCameraSphere.matrixAutoUpdate=!1,d.cubeCameraSphere.updateMatrix(),d.VRObject.add(d.cubeCameraSphere),n.btn.addEventListener("click",function(e){d.controls.autoRotate?d._pause():d._play(),d.controls.autoRotate=!d.controls.autoRotate})}d.asteroidConfig.enable?(d.cubeCameraSphere.visible=!0,d.asteroidForward=function(e){d.cubeCamera.update(d.renderer,d.scene),R(e)}):d.cubeCameraSphere.visible=!1}else{if(d.resType.video==t||d.resType.sliceVideo==t){if(d.video){E=d.video;for(var g=0;g<E.childNodes.length;g++)E.removeChild(E.childNodes[g])}else var E=d.video=AVR.createTag("video",{"webkit-playsinline":!0,playsinline:!0,preload:"auto","x-webkit-airplay":"allow","x5-playsinline":!0,"x5-video-player-type":"h5","x5-video-player-fullscreen":!0,"x5-video-orientation":"portrait",width:AVR.Broswer.isIE()?1920:"auto",height:AVR.Broswer.isIE()?960:"auto",style:"object-fit: fill",loop:"loop"},{allowsInlineMediaPlayback:!0,crossOrigin:"Anonymous"});if(d.resType.sliceVideo==t)if(Hls.isSupported())d.hls=new Hls,d.hls.attachMedia(E),d.hls.loadSource(e),d.hls.on(Hls.Events.MANIFEST_PARSED,function(){E.play()});else{var T=AVR.createTag("source",{src:e,type:"application/x-mpegURL"},null);E.appendChild(T)}else E.canPlayType("application/vnd.apple.mpegurl"),E.src=e;E.removeEventListener("canplaythrough",w),n.progressBar.removeEventListener("click",y),n.btn.removeEventListener("click",b),E.addEventListener("canplaythrough",w,!1),n.progressBar.addEventListener("click",y,!1),n.btn.addEventListener("click",b,!1),E.load();try{E.play()}catch(e){}function b(e){E.paused?(d._play(),E.play()):(d._pause(),E.pause())}function y(e){var t=(e.clientX||e.changedTouches[0].clientX)-d.container.offsetLeft;E.currentTime=E.duration*(t/this.clientWidth)}function w(e){d.video.buffTimer||(d.video.buffTimer=setInterval(function(e){var t=0;0!=E.buffered.length&&(t+=E.buffered.end(0)),t>=E.duration&&clearInterval(d.video.buffTimer),n.loadedProgress.style.width=t/E.duration*100+"%"},500))}d.video.buffTimer=null,(u=new THREE.VideoTexture(E)).generateMipmaps=!1,u.minFilter=THREE.LinearFilter,u.magFilter=THREE.LinearFilter,u.format=THREE.RGBAFormat,x(u),d.video.progressTimer=setInterval(function(e){n.playProgress.style.width=E.currentTime/E.duration*100+"%",n.curTime.innerText=AVR.formatSeconds(E.currentTime),n.totalTime.innerText=AVR.formatSeconds(E.duration),d.autoHideLeftTime<0&&!E.paused?n.toolbar.style.display="none":d.autoHideLeftTime--},1e3),d.loadProgressManager.onLoad()}else new THREE.TextureLoader(d.loadProgressManager).load(e,function(e){x(e,!0)});function x(e,t){t=t||!1,material=new THREE.MeshBasicMaterial({overdraw:!0,map:e});var i=d.VRObject.getObjectByName("__mxrealityDefault");if(i)i.material=material;else{var r=-Math.PI/2,o=new THREE.SphereBufferGeometry(d.vrbox.radius,d.vrbox.widthSegments,d.vrbox.heightSegments,r);o.scale(-1,1,1),mesh=new THREE.Mesh(o,material),mesh.visible=!1,mesh.name="__mxrealityDefault",t&&(mesh.matrixAutoUpdate=!1,mesh.updateMatrix(),d.toolBar.timeInfo.style.display="none"),d.VRObject.add(mesh)}d.asteroidConfig.enable&&(d.asteroidForward=function(e){R(e)})}}function R(t){d.controls&&(d.controls.reset(),d.controls.enable=!1);var i=d.asteroidConfig,r=d.camera.fov,e=d._containerRadius*(.9*d._cubeCameraTimes);d.camera.position.y=e*i.asteroidTop,d.camera.rotation.x=THREE.Math.degToRad(-90),d.camera.fov=i.asteroidFov;var o=i.asteroidForwardTime*i.asteroidFPS/300,n=e/o,a=(d.camera.fov-r)/o,s=(Math.PI,!1),c=!1,l=new THREE.Vector3(d._controlTarget.x,d._controlTarget.y,d._controlTarget.z);setTimeout(function(){var e=setInterval(function(){0<=i.asteroidTop*d.camera.position.y-n?(d.camera.position.y-=n*i.asteroidTop,d.camera.lookAt(l),l.z*=1.25):s=!0,d.camera.fov-a>=r?d.camera.fov-=a:c=!0,s&&c&&(clearInterval(e),d.controls.enable=!0,d.camera.position.y=0,d.camera.fov=r,void 0!==t&&t())},i.asteroidFPS)},i.asteroidWaitTime)}},VR.prototype.sphere2BoxPano=function(e,u,m,n){var h=this,a={x:"x",nx:"nx",ny:"ny",y:"y",z:"z",nz:"nz"},v=[],s=0,c=0,l=new Image;function d(e,t,i,r){var o=e.createTexture();return o?(function(e,t,i,r,o){h.asteroidConfig.enable&&e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,-1);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,o),e.uniform1i(r,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_STRIP,0,t),s<5?s++:n(function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=6*u,e.height=m;var i=document.createElement("canvas"),r=i.getContext("2d");i.width=u,i.height=m;var o=180*Math.PI/180;{if(r.rotate(o),h.sliceSegment){var n=[],a=document.createElement("canvas");a.width=m/h.sliceSegment,a.height=m/h.sliceSegment;var s=a.getContext("2d");for(var c in v){r.drawImage(v[c],0,0,-u,-m);for(var l=0;l<h.sliceSegment;l++)for(var d=0;d<h.sliceSegment;d++)s.putImageData(r.getImageData(d*(m/h.sliceSegment),l*(m/h.sliceSegment),m*(d+1)/h.sliceSegment,m*(l+1)/h.sliceSegment),0,0),n.push(a.toDataURL("image/jpeg"))}return n}for(var c in v)r.drawImage(v[c],0,0,-u,-m),t.drawImage(i,u*c,0,u,m);return e.toDataURL("image/jpeg")}}())}(e,i,o,e.getUniformLocation(t,"u_Sampler"),r),!0):(console.log("Failed to create the texture object!"),!1)}function f(e,t){var i=new Float32Array([-1,1,0,1,-1,-1,0,0,1,1,1,1,1,-1,1,0]),r=e.createBuffer();if(!r)return console.log("Failed to create the buffer object!"),-1;e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW);var o=i.BYTES_PER_ELEMENT,n=e.getAttribLocation(t,"a_Position");e.vertexAttribPointer(n,2,e.FLOAT,!1,4*o,0),e.enableVertexAttribArray(n);var a=e.getAttribLocation(t,"a_TexCoord");return e.vertexAttribPointer(a,2,e.FLOAT,!1,4*o,2*o),e.enableVertexAttribArray(a),4}function p(e,t){var i,r=g(e,t),o=g(e);return i=e.createProgram(),e.attachShader(i,o),e.attachShader(i,r),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)?(e.useProgram(i),e.enableVertexAttribArray(i.vertexPositionAttribute),i.vertexColorAttribute=e.getAttribLocation(i,"aVertexColor"),i.pMatrixUniform=e.getUniformLocation(i,"uPMatrix"),i.mvMatrixUniform=e.getUniformLocation(i,"uMVMatrix"),i):null}function g(e,t){var i,r;if(t){if(!(i=function(e){var t="",i="\n        precision mediump float;\n        varying vec2 v_TexCoord;\n        uniform sampler2D u_Sampler;\n        uniform float PI;\n",r="\n        if(abs(theta)>PI){\n            if(theta>PI){\n                theta -= 2.0*PI;\n            }else{\n                theta += 2.0*PI;\n            }\n        }\n        if(abs(phi)>PI/2.0){\n            if(phi>PI/2.0){\n                phi -= PI;\n            }else{                phi += PI;\n            }\n        }\n        float x = theta/PI*0.5 + 0.5;\n        float y = phi/PI*2.0*0.5 + 0.5;\n        gl_FragColor = texture2D(u_Sampler, vec2(x,y));\n";"z"==e?t=i+"\n\t\t\tvoid main() {\n\t\t\t\tfloat r = 0.5;\n\t\t\t\tvec2 orig = vec2(0.5-v_TexCoord.x,v_TexCoord.y-0.5);\n\t\t\t\tfloat theta = atan(orig.x,r);\n\t\t\t\tfloat phi = atan(orig.y*cos(theta),r);"+r+"\n\t\t\t}\n":"nz"==e?t=i+"\n\t\t\tvoid main() {\n\t\t\t\tfloat r = 0.5;\n\t\t\t\tvec2 orig = vec2(0.5-v_TexCoord.x,v_TexCoord.y-0.5);\n\t\t\t\tfloat theta = atan(orig.x,r);\n\t\t\t\tfloat phi = atan(orig.y*cos(theta),r);\n        \t\ttheta = theta+PI;\n"+r+"\n\t\t\t}\n":"x"==e?t=i+"\n\t\t\tvoid main() {\n\t\t\t\tfloat r = 0.5;\n\t\t\t\tvec2 orig = vec2(v_TexCoord.x-0.5,v_TexCoord.y-0.5);\n\t\t\t\tfloat theta = atan(r,orig.x);\n\t\t\t\tfloat phi = atan(orig.y*sin(theta),r);"+r+"\n\t\t\t}\n":"nx"==e?t=i+"\n\t\t\tvoid main() {\n\t\t\t\tfloat r = 0.5;\n\t\t\t\tvec2 orig = vec2(v_TexCoord.x-0.5,v_TexCoord.y-0.5);\n\t\t\t\tfloat theta = atan(r,orig.x);\n\t\t\t\tfloat phi = atan(orig.y*sin(theta),r);\n        \t\ttheta = theta+PI;"+r+"\n\t\t\t}\n":"y"==e?t=i+"\n\t\t\tvoid main() {\n\t\t\t\tfloat r = 0.5;\n\t\t\t\tvec2 orig = vec2(0.5-v_TexCoord.x,0.5-v_TexCoord.y);\n        \t\tfloat theta = atan(orig.x,orig.y);\n        \t\tfloat phi = atan(r*sin(theta),orig.x);"+r+"\n\t\t\t}\n":"ny"==e?t=i+"\n\t\t\tvoid main() {\n\t\t\t\tfloat r = 0.5;\n\t\t\t\tvec2 orig = vec2(0.5-v_TexCoord.x,v_TexCoord.y-0.5);\n\t\t\t\tfloat theta = atan(orig.x,orig.y);\n\t\t\t\tfloat phi = atan(r*sin(theta),orig.x);\n\t\t\t\tphi = -phi;"+r+"\n\t\t\t}\n":console.error("shader fragment type error!");return t}(t)))return null;r=e.createShader(e.FRAGMENT_SHADER)}else i="\n        attribute vec4 a_Position;\n        attribute vec2 a_TexCoord;\n        varying vec2 v_TexCoord;\n        void main() {\n            gl_Position= a_Position;\n            v_TexCoord = a_TexCoord;\n        }\n",r=e.createShader(e.VERTEX_SHADER);return e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.log(e.getShaderInfoLog(r)),null)}l.crossOrigin="Anonymous",l.src=e,l.onload=function(){for(var e in a){var t=document.createElement("canvas");t.width=u,t.height=m,t.id="face_"+e;var i=(v[c]=t).getContext("webgl",{preserveDrawingBuffer:!0}),r=p(i,e),o=f(i,r),n=i.getUniformLocation(r,"PI");i.uniform1f(n,Math.PI),i.clearColor(0,0,0,1),d(i,r,o,l)||console.log("Failed to intialize the texture."),c++}}};var AR=function(e,t,i,r,o){this.scene=e,this.renderer=t,this.container=i,AVR.setCameraPara(this,r,o),this.constraints={},this.video=null,this.openAudio=!1,this.cameraIndex=1,this._controlTarget=new THREE.Vector3(1e-4,0,0),this.camera=new THREE.PerspectiveCamera(this.cameraPara.fov,this.cameraPara.aspect,this.cameraPara.near,this.cameraPara.far),this.camera.position.set(this.cameraPosition.x,this.cameraPosition.y,this.cameraPosition.z),this.cameraReady=!1,this.scene.add(this.camera),this.clock=new THREE.Clock,this.tempCanvas=document.createElement("canvas"),this.effect=AVR.stereoEffect(this.renderer),this._takeScreenShot=!1};AR.prototype.init=function(){var t=this;if(AVR.bindOrientationEnevt(t,t._controlTarget),this.video=AVR.createTag("video",{"webkit-playsinline":!0,playsinline:!0,preload:"auto","x-webkit-airplay":"allow","x5-playsinline":!0,"x5-video-player-type":"h5","x5-video-player-fullscreen":!0,"x5-video-orientation":"portrait",style:"object-fit: fill",autoplay:"autoplay"},{allowsInlineMediaPlayback:!0}),this.video.style.zIndex="-99999",this.video.style.position="absolute",this.video.style.left="0px",this.video.style.top="0px",this.video.style.width="2px",this.video.style.height="2px",document.body.appendChild(this.video),this.video.oncanplaythrough=function(){t.cameraReady=!0,t.video.readyState===t.video.HAVE_ENOUGH_DATA&&(t.cameraTexture=new THREE.VideoTexture(t.video),t.cameraTexture.generateMipmaps=!1,t.cameraTexture.format=THREE.RGBAFormat,t.cameraTexture.maxFilter=THREE.NearestFilter,t.cameraTexture.minFilter=THREE.NearestFilter,t.scene.background=t.cameraTexture,t.cameraTexture.needsUpdate=!0)},navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,navigator.getUserMedia){var e={audio:t.openAudio,video:{facingMode:{exact:t.cameraIndex?"environment":"user"}}};navigator.getUserMedia(e,function(e){t.video.srcObject=e},function(e){alert(e)})}else alert("Native device meadia streaming(getUserMdeia) not supported in this browser.")},AR.prototype.takeCameraPhoto=function(){var e=this.tempCanvas.getContext("2d");return e.clearRect(0,0,window.innerWidth,window.innerHeight),e.drawImage(this.video,0,0,window.innerWidth,window.innerHeight),e.toDataURL("image/jpeg")},AR.prototype.takeScreenShot=function(e){this._takeScreenShot=!0,this._takeScreenShotCallback=e};var AVR={debug:!(AR.prototype.play=function(){var r=this;!function e(){requestAnimationFrame(e),function(){if(r._takeScreenShot){r._takeScreenShot=!1;var e=r.renderer.domElement.toDataURL("image/jpeg");r._takeScreenShotCallback(e)}if(r.cameraReady){var t=window.innerWidth,i=window.innerHeight;r.camera.aspect=t/i,r.cameraTexture.repeat.y=i/r.video.videoHeight,r.cameraTexture.offset.x=0,r.cameraTexture.offset.y=0,AVR.isMobileDevice()&&AVR.isCrossScreen()?(r.cameraTexture.repeat.x=t/(2*r.video.videoWidth),r.effect.setSize(t,i),r.effect.render(r.scene,r.camera)):(r.cameraTexture.repeat.x=t/r.video.videoWidth,r.renderer.setSize(t,i),r.renderer.setClearColor(new THREE.Color(16777215)),r.renderer.render(r.scene,r.camera)),r.camera.updateProjectionMatrix()}r.controls&&r.controls.update(r.clock.getDelta())}()}()}),startGyro:function(t){window.addEventListener("deviceorientation",function(e){t(e)},!1)},stereoEffect:function(i){var r,o;this.separation=1,this.focalLength=15;var n,a,s,c,l,d,u,m,h,v=new THREE.Vector3,f=new THREE.Quaternion,p=new THREE.Vector3,g=new THREE.PerspectiveCamera,E=new THREE.PerspectiveCamera;return i.autoClear=!1,this.setSize=function(e,t){r=e/2,o=t,i.setSize(e,t)},this.render=function(e,t){e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorld.decompose(v,f,p),n=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(t.fov)))),d=t.near/this.focalLength,m=Math.tan(.5*THREE.Math.degToRad(n))*this.focalLength,u=.5*m*t.aspect,l=-(c=m*d),h=(u+this.separation/2)/(2*u),a=2*u*d*(1-h),s=2*u*d*h,g.projectionMatrix.makePerspective(-a,s,c,l,t.near,t.far),g.position.copy(v),g.quaternion.copy(f),g.translateX(-this.separation/2),E.projectionMatrix.makePerspective(-s,a,c,l,t.near,t.far),E.position.copy(v),E.quaternion.copy(f),E.translateX(this.separation/2),i.setViewport(0,0,2*r,o),i.setViewport(0,0,r,o),i.render(e,g),i.setViewport(r,0,r,o),i.render(e,E)},this},orbitControls:function(e,t){var i=function(e,t){this.domElement=void 0!==t?t:document,this.object=e,this.object.rotation.reorder("YXZ"),this.enable=!0,this.target=new THREE.Vector3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.rotateSpeed=.25,this.autoRotate=!1,this.autoRotateSpeed=1,this.deviceOrientation={},this.screenOrientation=0;var c=this;c.defaultDirectionOfRotation=!0,c.gyroEnable=!1,c.usingGyro=!!AVR.OS.isMobile(),c._defaultTargetY=c.target.y,c._defaultCameraFov=c.object.fov,c._defaultCameraY=c.object.position.y;var l={type:"change"},d=new THREE.Spherical,u=new THREE.Spherical,n=new THREE.Vector2,a=new THREE.Vector2,s=new THREE.Vector2,m=new THREE.Vector3(0,0,0),h=0,v=0,f=0,p=0;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.rotation0=this.object.rotation.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.rotation0.copy(c.object.rotation),c.zoom0=c.object.zoom},this.reset=function(e){this.resetVar(),c.dispatchEvent(l),e&&e.target0?c.target.copy(e.target0):c.target.copy(c.target0),e&&e.position0?c.object.position.copy(e.position0):c.object.position.copy(c.position0),e&&e.rotation0?c.object.rotation.copy(e.rotation0):c.object.rotation.copy(c.rotation0),e&&e.zoom0?c.zoom=zoom0:c.zoom0},this.resetVar=function(){h=p=f=v=0};var g,E,T,b,y,w,x,R,A,H=(g=new THREE.Vector3(0,0,1),E=new THREE.Euler,T=new THREE.Quaternion,b=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,i,r,o){E.set(i,t,-r,"YXZ"),e.setFromEuler(E),e.multiply(b),e.multiply(T.setFromAxisAngle(g,-o))});function S(e){c.defaultDirectionOfRotation?c.usingGyro?u.theta-=e:u.theta+=e:u.theta-=e}function C(e){c.defaultDirectionOfRotation?c.usingGyro?u.phi-=e:u.phi+=e:u.phi-=e}function V(e,t){return 2*Math.PI*e/t*c.rotateSpeed}function L(e,t){return 2*Math.PI*e/t*c.rotateSpeed}var r=!(this.update=(y=new THREE.Vector3,w=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),x=w.clone().inverse(),R=new THREE.Vector3,A=new THREE.Quaternion,function(e){if(c.enable){e=e||{};var t=c.deviceOrientation.alpha?THREE.Math.degToRad(void 0===c.beginAlpha?c.deviceOrientation.alpha:c.deviceOrientation.alpha-c.beginAlpha):0,i=c.deviceOrientation.beta?THREE.Math.degToRad(c.deviceOrientation.beta):0,r=c.deviceOrientation.gamma?THREE.Math.degToRad(c.deviceOrientation.gamma):0,o=c.screenOrientation?THREE.Math.degToRad(c.screenOrientation):0;c.gyroEnable?(v=t,f=i,p=r):(t=v,i=f,r=p);var n=(new THREE.Quaternion).copy(c.object.quaternion);H(n,t,i,r,o);var a=function(e,t,i,r){var o,n,a,s=e*t+i*r;if(.499<s){a=2*Math.atan2(e,r),o=Math.PI/2,n=0;var c=new THREE.Vector3(o,n,a);return c}if(s<-.499){a=-2*Math.atan2(e,r),o=-Math.PI/2,n=0;var c=new THREE.Vector3(o,n,a);return c}var l=e*e,d=t*t,u=i*i;return a=Math.atan2(2*t*r-2*e*i,1-2*d-2*u),o=Math.asin(2*s),n=Math.atan2(2*e*r-2*t*i,1-2*l-2*u),c=new THREE.Vector3(o,n,a)}(n.x,n.y,n.z,n.w);e.init||S(h-a.z),a.y,h=a.z;var s=c.object.position;return y.copy(s).sub(c.target),y.applyQuaternion(w),d.setFromVector3(y),c.autoRotate&&S(2*Math.PI/60/60*c.autoRotateSpeed),d.theta+=u.theta,d.phi+=u.phi,d.theta=Math.max(c.minAzimuthAngle,Math.min(c.maxAzimuthAngle,d.theta)),d.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,d.phi)),d.makeSafe(),y.setFromSpherical(d),y.applyQuaternion(x),s.copy(c.target).add(y),c.deviceOrientation&&c.gyroEnable?H(c.object.quaternion,t+Math.PI+m.x,i+m.y,r+m.z,o):c.object.lookAt(c.target),c.enableDamping&&!c.gyroEnable?(u.theta*=1-c.dampingFactor,u.phi*=1-c.dampingFactor):u.set(0,0,0),(1e-6<R.distanceToSquared(c.object.position)||1e-6<8*(1-A.dot(c.object.quaternion)))&&(c.dispatchEvent(l),R.copy(c.object.position),A.copy(c.object.quaternion),!0)}}));window.addEventListener("orientationchange",function(e){c.screenOrientation=window.orientation||0},!1),window.addEventListener("deviceorientation",function(e){c.deviceOrientation=e,void 0===c.beginAlpha&&(c.beginAlpha=c.deviceOrientation.alpha)},!1),this.gyroFreeze=function(){c.gyroEnable=!1},this.gyroUnfreeze=function(){c.gyroEnable=!0},this.rotationLeft=S,this.rotationUp=C,this.domElement.addEventListener("mousedown",function(e){r=!0;var t=e.clientX||e.changedTouches[0].clientX,i=e.clientY||e.changedTouches[0].clientY;n.set(t,i)},!1),this.domElement.addEventListener("mousemove",function(e){c.enable&&r&&function(e){var t=e.clientX||e.changedTouches[0].clientX,i=e.clientY||e.changedTouches[0].clientY;a.set(t,i),s.subVectors(a,n);var r=void 0!==c.domElement.clientWidth?c.domElement.clientWidth:window.innerWidth;S(V(s.x,r));var o=void 0!==c.domElement.clientHeight?c.domElement.clientHeight:window.innerHeight;C(L(s.y,o)),n.copy(a)}(e)},!1),this.domElement.addEventListener("mouseup",function(e){r=!1},!1),this.domElement.addEventListener("touchstart",function(e){r=!0,n.set(e.touches[0].pageX,e.touches[0].pageY),c.usingGyro=!1},!1),this.domElement.addEventListener("touchend",function(e){c.usingGyro=!!AVR.OS.isMobile(),r=!1},!1),this.domElement.addEventListener("touchmove",function(e){e.preventDefault(),a.set(e.touches[0].pageX,e.touches[0].pageY),s.subVectors(a,n);var t=null!=c.domElement.clientWidth?c.domElement.clientWidth:window.innerWidth;S(V(s.x,t));var i=void 0!==c.domElement.clientHeight?c.domElement.clientHeight:window.innerHeight;C(L(s.y,i)),n.copy(a),m.x+=V(s.x,t)+L(s.y,i),c.usingGyro=!1},!1);var i=void 0!==this.domElement.clientWidth?this.domElement.clientWidth:window.innerWidth,o=void 0!==this.domElement.clientHeight?this.domElement.clientHeight:window.innerHeight;return n.set(i/2,o/2),setTimeout(function(){c.update({init:!0}),c.saveState()},10),this};return new((i.prototype=Object.create(THREE.EventDispatcher.prototype)).constructor=i)(e,t)},setCameraPara:function(e,t,i){if(e.cameraPara={fov:90,aspect:e.container.innerWidth/e.container.innerHeight,near:.001,far:1e3},e.cameraPosition={x:0,y:0,z:0},t)for(var r in t)e.cameraPara[r]=t[r];if(i)for(var r in i)e.cameraPosition[r]=i[r]},formatSeconds:function(e){var t=parseInt(e),i=0,r=0;60<t&&(i=parseInt(t/60),t=parseInt(t%60),60<i&&(r=parseInt(i/60),i=parseInt(i%60)));var o=""+(parseInt(t)<10?"0"+parseInt(t):parseInt(t));return o=0<=i&&0<r?(parseInt(r)<10?"0"+parseInt(r):parseInt(r))+":"+(parseInt(i)<10?"0"+parseInt(i):parseInt(i))+":"+o:0<i&&0==r?60==i?"01:00:"+o:(parseInt(i)<10?"0"+parseInt(i):parseInt(i))+":"+o:60==t?"01:00":"00:"+o},cameraVector:function(e,t){var i=new THREE.Vector3(0,0,-1).applyQuaternion(e.quaternion),r=i.clone(),o=new THREE.Vector3;return t&&(o.x=i.x*t,o.y=i.y*t,o.z=i.z*t),{vector:r,timesVector:o}},bindRaycaster:function(e,t,i){var r=AVR.screenPosTo3DCoordinate(e,t.container,t.camera),o=new THREE.Raycaster(t.camera.position,r.sub(t.camera.position).normalize()).intersectObjects(t.scene.children,!0);o.length?i.success(o):i.empty()},bindCameraEvent:function(i,r){var o=this,e=(r=r||{trigger:function(e){},empty:function(e){},move:function(e){}}).scale||.022,n=r.vectorRadius,t=n*e,a=n*(e/6),s=r.tubularSegments||60,c=r.speed||36,l=new THREE.Group;l.name="__controlHandle";for(var d=new THREE.TorusGeometry(t,a,2,s,2*Math.PI),u=[],m=0;m<d.faces.length/2;m++)u[m]=new THREE.MeshBasicMaterial({color:15194842,depthTest:!1});for(var h=0,v=[new THREE.Vector2(0,0),new THREE.Vector2(1,0),new THREE.Vector2(1,1),new THREE.Vector2(0,1)],f=(m=0,d.faces.length);m<f;m+=2)d.faces[m].materialIndex=h,d.faces[m+1].materialIndex=h,d.faceVertexUvs[0][m]=[v[3],v[0],v[2]],d.faceVertexUvs[0][m+1]=[v[0],v[1],v[2]],h++;var p=new THREE.Mesh(d,u);p.name="__wait",p.visible=!1,l.add(p);var g=new THREE.Mesh(new THREE.CircleGeometry(a,4),new THREE.MeshBasicMaterial({color:15194842,wireframe:!0,depthTest:!1}));g.lookAt(i.camera.position),g.name="__focus",g.material.depthTest=!1,g.visible=!1,l.add(g),l.position.set(0,0,.1);new THREE.Vector3;var E=null;i.VRObject.add(l),i.cameraEvt.controlGroup=l,i.cameraEvt.updatePosition=function(){l.lookAt(0,0,0),p.lookAt(0,0,0);var e=o.cameraVector(i.camera,n);g.visible=!0,l.position.set(e.timesVector.x,e.timesVector.y,e.timesVector.z);var t=new THREE.Raycaster(i.camera.position,e.vector).intersectObjects(i.scene.children,!0);t.length?r.move(t):r.empty(t)},i.cameraEvt.hover=function(e){p.visible=!0;var t=0,i=0;E||(E=setInterval(function(){i<d.faces.length/4?(u[i].color=new THREE.Color(14710133),d.needsUpdate=!0,d.faces[t].materialIndex=i,d.faces[t+1].materialIndex=i,d.faceVertexUvs[0][t]=[v[3],v[0],v[2]],d.faceVertexUvs[0][t+1]=[v[0],v[1],v[2]],t+=2):(clearInterval(E),E=null,r.trigger(e)),i++},c))},i.cameraEvt.leave=function(e){clearInterval(E),E=null;for(var t=h=0,i=d.faces.length;t<i;t+=2)u[h].color=new THREE.Color(15194842),d.needsUpdate=!0,d.faces[t].materialIndex=h,d.faces[t+1].materialIndex=h,d.faceVertexUvs[0][t]=[v[3],v[0],v[2]],d.faceVertexUvs[0][t+1]=[v[0],v[1],v[2]],h++;p.visible=!1}},screenPosTo3DCoordinate:function(e,t,i){var r=e.clientX||(e.touches?e.touches[0].clientX:0),o=e.clientY||(e.touches?e.touches[0].clientY:0),n=document.body.scrollTop||document.documentElement.scrollTop,a=document.body.scrollLeft||document.documentElement.scrollLeft,s=t.offsetTop,c=r-(t.offsetLeft-a),l=o-(s-n);c=0<=c?c:0,l=0<=l?l:0;var d=t.clientWidth,u=t.clientHeight,m=new THREE.Vector2;return m.x=2*c/d-1,m.y=1-2*l/u,new THREE.Vector3(m.x,m.y,0).unproject(i).sub(i.position).normalize()},objectPosToScreenPos:function(e,t,i){var r=new THREE.Vector3;r.setFromMatrixPosition(e.matrixWorld).project(i);var o=r.x,n=r.y,a=t.clientWidth,s=t.clientHeight,c=new THREE.Vector2;return c.x=a/2*(o+1),c.y=s/2*(1-n),c},fullscreen:function(e){document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||!1?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():e.requestFullscreen&&e.requestFullscreen()||e.mozRequestFullScreen&&e.mozRequestFullScreen()||e.webkitRequestFullscreen&&e.webkitRequestFullscreen()||e.msRequestFullscreen&&e.msRequestFullscreen()},isFullscreen:function(){return document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||!1},toolBar:function(e){var t="_toolBar",i=this.createTag("div",{style:"-moz-user-select:none;-webkit-user-select:none;user-select:none;position:absolute;background:rgba(0,0,0,.2);width:100%;height:2.2rem;bottom:0rem",class:t+"Area"}),r=this.createTag("div",{style:"position:inherit;border-top:0.6rem solid transparent;border-left:1rem solid white;border-bottom:0.6rem solid transparent;bottom:0.25rem;left:1rem;color:#fff;font-weight:800;cursor:pointer",class:t+"Btn"});i.appendChild(r);var o=this.createTag("div",{style:"position:inherit;bottom:0.25rem;left:2.8rem;color:#fff;font-size:0.75rem"}),n=this.createTag("span",null,{innerText:"00:00"});o.appendChild(n);var a=this.createTag("span",null,{innerText:"/"});o.appendChild(a);var s=this.createTag("span",null,{innerText:"00:00"});o.appendChild(s),i.appendChild(o);var c=document.styleSheets[0];c.insertRule("@keyframes moreTip{from {top:0.75rem;} to{top:1rem}}",0),AVR.Broswer.isIE()||c.insertRule("@-webkit-keyframes moreTip{from {top:0.75rem;} to{top:1rem}}",0);var l=this.createTag("span",{style:"width:2.2rem;height:2.2rem;position:inherit;left:50%;margin-left:-1.1rem;margin-top:-0.75rem;color:#fff;font-size:1.5rem;cursor:pointer;animation:moreTip 1s infinite;-moz-animation:moreTip 1s infinite;-webkit-animation:moreTip 1s infinite;"},{innerText:""}),d=this.createTag("div",{style:"width:100%;height:auto;position:inherit;background:rgba(0,0,0,0);top:2.4rem;bottom:1.8rem;overflow: hidden;"},null),u=this.createTag("ul",{style:"display:flex;display: -webkit-flex;display: -webkit-box;display: -moz-box;display: -ms-flexbox;margin:0;padding:0;list-style:none;height:100%;"},null);d.appendChild(u),i.appendChild(l),i.appendChild(d);var m=this.createTag("div",{style:"width:2.2rem;height:2.2rem;position:inherit;right:1rem;margin-left:-1.1rem;margin-top:0.6rem;color:#fff;font-size:1.2rem;cursor:pointer;display:none",copy:"&#67;&#111;&#112;&#121;&#114;&#105;&#103;&#104;&#116;&#32;&#169;&#32;&#50;&#48;&#49;&#56;&#32;&#87;&#87;&#87;&#46;&#77;&#88;&#82;&#69;&#65;&#76;&#73;&#84;&#89;&#46;&#67;&#78;&#46;&#32;&#65;&#108;&#108;&#32;&#114;&#105;&#103;&#104;&#116;&#115;&#32;&#114;&#101;&#115;&#101;&#114;&#118;&#101;&#100;&#46;"},{innerText:"？"});function h(e){for(var t=e.match(/&#(\d+);/g),i="",r=0;r<t.length;r++)i+=String.fromCharCode(t[r].replace(/[&#;]/g,""));return i}m.addEventListener("click",function(){var e=this.getAttribute("copy");alert(h(e))},!1),m.addEventListener("mouseover",function(){var e=this.getAttribute("copy");this.setAttribute("title",h(e))},!1),i.appendChild(m);var v=this.createTag("div",{style:"border:0.125rem solid white;border-radius:1rem;width:1rem;height:1rem;position:inherit;right:5.8rem;line-height:1rem;bottom:0.25rem;cursor:pointer"}),f=this.createTag("div",{style:"border:0.08rem solid white;border-radius:8rem;background:rgba(240,240,240,0.6);width:0.3rem;left:0.26rem;top:0.26rem;height:0.3rem;position:inherit;line-height:0.3rem;cursor:pointer"});v.appendChild(f),i.appendChild(v);var p=this.createTag("div",{style:"border:0.125rem solid white;border-radius:1rem;width:1.4rem;height:1rem;position:inherit;right:3.5rem;line-height:1rem;bottom:0.25rem;cursor:pointer"}),g=this.createTag("div",{style:"position:inherit;width:1.235rem;height:0.4rem;line-height:0.4rem;border:0.0625rem solid white;border-radius:0.6rem/0.2rem;margin-top:0.25rem;margin-left:0.055rem;"});p.appendChild(g);var E=this.createTag("div",{style:"position:inherit;width:1rem;height:0.4rem;line-height:0.4rem;border:0.0625rem solid white;border-radius:0.6rem/0.2rem;margin-top:0.25rem;margin-left:0.175rem;transform:rotate(90deg)"});p.appendChild(E),i.appendChild(p);var T=this.createTag("div",{style:"position:inherit;right:1rem;width:1.4rem;height:1rem;line-height:1rem;border:0.125rem solid white;border-radius:0.125rem;bottom:0.25rem;text-align:center;font-weight:800;color:#fff;font-size:0.75rem;cursor:pointer"},{innerText:"VR"});i.appendChild(T);var b=this.createTag("div",{style:"position:inherit;top:0rem;width:100%;height:0.1rem;background:rgba(255,255,255,.3);cursor:pointer"}),y=this.createTag("div",{style:"position:inherit;width:0%;height:0.1rem;background:rgba(255,255,255,.3)"});b.appendChild(y);var w=this.createTag("div",{style:"position:inherit;width:0%;height:0.1rem;background:rgba(28, 175, 252,.6)"});b.appendChild(w),i.appendChild(b),e.appendChild(i);var x=this.createTag("div",{style:"-moz-user-select:none;-webkit-user-select:none;user-select:none;position:absolute;width:2rem;height:60%;background:rgba(0,0,0,0);left:0rem;top:20%;text-align:center;display:none;border-radius:1rem;"}),R=this.createTag("div",{style:"position:inherit;width:0.25rem;background:rgba(255,255,255,.1);height:100%;left:0.875rem;cursor:pointer;border-radius:1rem;"});x.appendChild(R);var A=this.createTag("div",{style:"position:inherit;width:100%;background:rgba(255, 255, 255,.6);bottom:0rem;;border-radius:1rem;"});return R.appendChild(A),e.appendChild(x),{toolbar:i,btn:r,timeInfo:o,curTime:n,splitTime:a,totalTime:s,moreBtn:l,moreList:d,moreListUl:u,vrBtn:T,progressBar:b,loadedProgress:y,playProgress:w,gyroResetBtn:v,gyroBtn:p,circle1:g,circle2:E,voice_bar:x,about:m}},msgBox:function(e,t,i){var r=this.createTag("div",{style:"position:absolute;bottom:50%;width:100%;padding:0.25rem;background:rgba(0,0,0,.6);color:#fff;text-align:center;"},{innerHTML:e});i.appendChild(r),setTimeout(function(){r.remove()},1e3*t)},isMobileDevice:function(e){var t=navigator.userAgent.toLowerCase();if(e)return t.match(/ipad/i)||t.match(/iphone os/i)||t.match(/midp/i)||t.match(/rv:1.2.3.4/i)||t.match(/ucweb/i)||t.match(/android/i)||t.match(/windows ce/i)||t.match(/windows mobile/i);var i="ipad"==t.match(/ipad/i),r="iphone os"==t.match(/iphone os/i),o="midp"==t.match(/midp/i),n="rv:1.2.3.4"==t.match(/rv:1.2.3.4/i),a="ucweb"==t.match(/ucweb/i),s="android"==t.match(/android/i),c="windows ce"==t.match(/windows ce/i),l="windows mobile"==t.match(/windows mobile/i);return!!(i||r||o||n||a||s||c||l)},bindOrientationEnevt:function(e){void 0===e.controls&&(e.controls=AVR.orbitControls(e.camera,e.renderer.domElement),e.controls.target=e._controlTarget.clone())},isCrossScreen:function(e){return 180!=window.orientation&&0!=window.orientation&&(90==window.orientation||-90==window.orientation||void 0)},initDomStyle:function(e){document.body.style.overflow="hidden",document.body.style.margin=0,document.body.style.padding=0,e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.left="0px",e.style.top="0px",e.style.overflow="hidden";var t=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(t),document.body.addEventListener("touchmove",function(e){e.preventDefault()}),document.oncontextmenu=function(){return!1},document.onkeydown=function(){if(!this.debug&&window.event&&123==window.event.keyCode)return event.keyCode=0,event.returnValue=!1}},createTag:function(e,t,i){var r=document.createElement(e);if(t&&"object"==typeof t)for(var o in t)r.setAttribute(o,t[o]);if(i&&"object"==typeof i)for(var o in i)r[o]=i[o];return r},OS:{weixin:-1<navigator.userAgent.indexOf("MicroMessenger"),android:/android/i.test(navigator.userAgent.toLowerCase()),ios:/(iphone|ipad|ipod|ios)/i.test(navigator.userAgent.toLowerCase()),googlePixel:navigator.userAgent.match(/;\sPixel\sBuild\//),MiOS:navigator.userAgent.match(/;\sMI\s\d\sBuild\//),samsungOS:navigator.userAgent.match(/;\sSM\-\w+\sBuild\//),isGooglePixel:function(){return null!=this.googlePixel},isMiOS:function(){return null!=this.MiOS},isSamsung:function(){return null!=this.samsungOS},isMobile:function(){return this.android||this.ios},isAndroid:function(){return this.android},isiOS:function(){return this.ios},isWeixin:function(){return this.weixin}},Broswer:{win:window,nav:window.navigator,REG_APPLE:/^Apple/,ie:navigator.userAgent.match(/MSIE\s([\d.]+)/)||navigator.userAgent.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),edge:navigator.userAgent.match(/Edge\/([\d.]+)/),chrome:navigator.userAgent.match(/Chrome\/([\d.]+)/)||navigator.userAgent.match(/CriOS\/([\d.]+)/),webview:!this.chrome&&navigator.userAgent.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),safari:this.webview||navigator.userAgent.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/),chromiumType:null,_getChromiumType:function(){if(null!=this.chromiumType)return this.chromiumType;var e=this.win;return this.isIE()||void 0===e.scrollMaxX||this.REG_APPLE.test(this.nav.vendor||"")?"":this._testExternal(/^sogou/i,0)?"sogou":this._testExternal(/^liebao/i,0)?"liebao":this.nav.mimeTypes[30]||!this.nav.mimeTypes.length?"360":e.clientInformation&&e.clientInformation.permissions?"chrome":""},_testExternal:function(e,t){var i=this.win.external||{};for(var r in i)if(e.test(t?i[r]:r))return!0;return!1},isIE:function(){return null!=this.ie},ieVersion:function(){return null!=this.ie&&parseInt(this.ie[1])},isEdge:function(){return null!=this.edge},isSafari:function(){return null!=this.safari},is360:function(){return this.chromiumType=this._getChromiumType(),"360"===this.chromiumType},isSogou:function(){return this.chromiumType=this._getChromiumType(),"sogou"===this.chromiumType},isChromium:function(){return"chrome"===this._getChromiumType()},webglAvailable:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}}},head=document.getElementsByTagName("head")[0];head.appendChild(AVR.createTag("meta",{name:"viewport",content:"width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0,minimal-ui,user-scalable=no"})),head.appendChild(AVR.createTag("meta",{name:"google",content:"notranslate"})),head.appendChild(AVR.createTag("meta",{name:"full-screen",content:"yes"})),AVR.debug&&(window.onerror=function(e,t,i){var r="There was an error on this page.\n\n";return r+="Error: "+e+"\n",r+="URL: "+t+"\n",r+="Line: "+i+"\n\n",AVR.msgBox(r,36,document.body),!0});